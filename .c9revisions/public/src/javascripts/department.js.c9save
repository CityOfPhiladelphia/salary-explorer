{"ts":1360268505698,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1360268539044,"patch":[[{"diffs":[[1,"var Salaries = Salaries || {Models: {}, Views: {}, Collections: {}, Routers: {}}\r\n    ,FusionTable = FusionTable || {}\r\n    ,util = util || {};\r\n(function(app, db, util, $, _) {\r\n    \r\n    app.Collections.Departments = Backbone.Collection.extend({\r\n        defaultSettings: {\r\n            fields: [\"departmentid\", \"department\", \"salaries\", \"count\"]\r\n            ,group: true\r\n            ,orderby: \"salaries\"\r\n            ,dir: \"desc\"\r\n        }\r\n        ,initialize: function(models, options) {\r\n            this.settings = _.defaults(options.settings || {}, this.defaultSettings);\r\n            this.sum = 0;\r\n            this.count = 0;\r\n        }\r\n        ,url: function() { return db.buildUrl(db.query(this.settings)) + \"&callback=?\"; }\r\n        ,parse: function(response) {\r\n            // Convert array of arrays to array of objects with our keys/fields\r\n            var objects = [], object, i, key, self = this;\r\n            if(response.rows !== undefined && response.rows.length) {\r\n                _.each(response.rows, function(row) {\r\n                    object = {};\r\n                    i = 0;\r\n                    for(i in row) {\r\n                        key = self.settings.fields[i];\r\n                        object[key] = (key === \"salaries\" || key === \"count\" ? parseInt(row[i]) : row[i]);\r\n                    }\r\n                    objects.push(object);\r\n                    \r\n                    // Add to the totals\r\n                    self.count += object[\"count\"] || 0;\r\n                    self.sum += object[\"salaries\"] || 0;\r\n                });\r\n            }\r\n            return objects;\r\n        }\r\n    });\r\n    \r\n    app.Views.DepartmentsView = Backbone.View.extend({\r\n        initialize: function() {\r\n            _.bindAll(this, \"toggleRow\")\r\n            this.collection = this.options.collection;\r\n            this.template = _.template($(\"#tmpl-departments\").html());\r\n            this.collection.on(\"reset\", this.render, this);\r\n        }\r\n        ,events: {\r\n            \"click .toggle\": \"toggleRow\"\r\n        }\r\n        ,toggleRow: function(e) {\r\n            e.preventDefault(e);\r\n            var button = $(e.currentTarget)\r\n                ,row = button.parent().parent().next(\".analysis\");\r\n            row.toggle();\r\n            button.find(\"i\").toggleClass(\"icon-plus\").toggleClass(\"icon-minus\");\r\n            \r\n            // Load salary groups\r\n            var salaryGroups = new app.Collections.SalaryGroups(null, {settings: {department: row.data(\"department\")}});\r\n            salaryGroups.fetch();\r\n            row.find(\"td\").eq(0).append((new app.Views.SalaryGroupsView({collection: salaryGroups})).render().el);\r\n        }\r\n        ,render: function() {\r\n            this.$el.html(this.template({rows: this.collection.toJSON(), sum: this.collection.sum, count: this.collection.count, settings: this.collection.settings, sortProps: util.getSortProps(this.collection.settings)}));\r\n            return this;\r\n        }\r\n    });\r\n    \r\n})(Salaries, FusionTable, util, jQuery, _);"]],"start1":0,"start2":0,"length1":0,"length2":3026}]],"length":3026,"saved":false}
{"ts":1360333301505,"patch":[[{"diffs":[[0,"efaults("],[1,"_.clone("],[0,"options."]],"start1":528,"start2":528,"length1":16,"length2":24},{"diffs":[[0,"settings"],[1,")"],[0," || {}, "]],"start1":552,"start2":552,"length1":16,"length2":17}]],"length":3035,"saved":false}
{"ts":1360333313832,"patch":[[{"diffs":[[0,"            "],[1,"//"],[0,"this.setting"]],"start1":497,"start2":497,"length1":24,"length2":26},{"diffs":[[0,"lts("],[-1,"_.clone("],[0,"opti"]],"start1":534,"start2":534,"length1":16,"length2":8},{"diffs":[[0,"settings"],[-1,")"],[0," || {}, "]],"start1":546,"start2":546,"length1":17,"length2":16}]],"length":3028,"saved":false}
{"ts":1360333342843,"patch":[[{"diffs":[[0,"        "],[-1,"//"],[0,"this.set"]],"start1":501,"start2":501,"length1":18,"length2":16}]],"length":3026,"saved":false}
{"ts":1360333450842,"patch":[[{"diffs":[[0,"efaults("],[1,"_.clone("],[0,"options."]],"start1":528,"start2":528,"length1":16,"length2":24},{"diffs":[[0,"settings"],[1,")"],[0," || {}, "]],"start1":552,"start2":552,"length1":16,"length2":17}]],"length":3035,"saved":false}
{"ts":1360333467728,"patch":[[{"diffs":[[0,"lts("],[-1,"_.clone("],[0,"opti"]],"start1":532,"start2":532,"length1":16,"length2":8},{"diffs":[[0,"settings"],[-1,")"],[0," || {}, "]],"start1":544,"start2":544,"length1":17,"length2":16}]],"length":3026,"saved":false}
{"ts":1360333541903,"patch":[[{"diffs":[[0,"= _."],[-1,"defaults"],[1,"extend"],[0,"(opt"]],"start1":523,"start2":523,"length1":16,"length2":14}]],"length":3024,"saved":false}
{"ts":1360337149186,"patch":[[{"diffs":[[0,"mplate({"],[1,"\r\n                "],[0,"rows: th"]],"start1":2737,"start2":2737,"length1":16,"length2":34},{"diffs":[[0,"toJSON()"],[1,"\r\n                "],[0,","],[-1," "],[0,"sum: thi"]],"start1":2785,"start2":2785,"length1":18,"length2":35},{"diffs":[[0,"tion.sum"],[1,"\r\n                "],[0,","],[-1," "],[0,"count: t"]],"start1":2828,"start2":2828,"length1":18,"length2":35},{"diffs":[[0,"on.count"],[1,"\r\n                "],[0,","],[-1," "],[0,"settings"]],"start1":2875,"start2":2875,"length1":18,"length2":35},{"diffs":[[0,"settings"],[1,"\r\n                "],[0,","],[-1," "],[0,"sortProp"]],"start1":2928,"start2":2928,"length1":18,"length2":35},{"diffs":[[0,"ettings)"],[1,"\r\n                ,buildFragment: app.router.buildFragment\r\n            "],[0,"}));\r\n  "]],"start1":3001,"start2":3001,"length1":16,"length2":88}]],"length":3182,"saved":false}
{"ts":1360337755727,"patch":[[{"diffs":[[0,"s)\r\n"],[-1,"                ,buildFragment: app.router.buildFragment\r\n"],[0,"    "]],"start1":3007,"start2":3007,"length1":66,"length2":8}]],"length":3124,"saved":false}
{"ts":1360339498883,"patch":[[{"diffs":[[0,"        "],[1,"//"],[0,",sortPro"]],"start1":2946,"start2":2946,"length1":16,"length2":18},{"diffs":[[0,"tings)\r\n"],[1,"                ,arrows: util.getArrows(this.collection.settings)\r\n"],[0,"        "]],"start1":3005,"start2":3005,"length1":16,"length2":83}]],"length":3193,"saved":false}
{"ts":1360340022176,"patch":[[{"diffs":[[0,"        "],[-1,"//"],[0,",sortPro"]],"start1":2946,"start2":2946,"length1":18,"length2":16},{"diffs":[[0,"lection.settings"],[1,", \"departments\""],[0,")\r\n             "]],"start1":2992,"start2":2992,"length1":32,"length2":47},{"diffs":[[0,"        "],[1,"//"],[0,",arrows:"]],"start1":3034,"start2":3034,"length1":16,"length2":18}]],"length":3208,"saved":false}
{"contributors":[],"silentsave":false,"ts":1360340388779,"patch":[[{"diffs":[[0,"ngs = _."],[-1,"extend"],[1,"defaults"],[0,"(options"]],"start1":519,"start2":519,"length1":22,"length2":24}]],"length":3210,"saved":false}
{"ts":1360343005362,"patch":[[{"diffs":[[0,"       });\r\n"],[1,"                objects.unshift({\r\n                    departmentid: null\r\n                    ,department: \"All Employees\"\r\n                    ,salaries: this.sum\r\n                    ,count: this.count\r\n                });\r\n"],[0,"            "]],"start1":1564,"start2":1564,"length1":24,"length2":251}]],"length":3437,"saved":false}
{"ts":1360343096060,"patch":[[{"diffs":[[0," $, _) {\r\n    \r\n"],[1,"    // TODO: Since this is not paginated, sorting should be done with javascript\r\n"],[0,"    app.Collecti"]],"start1":169,"start2":169,"length1":32,"length2":114}]],"length":3519,"saved":false}
{"ts":1360343156619,"patch":[[{"diffs":[[0,");\r\n"],[-1,"                objects.unshift({\r\n                    departmentid: null\r\n                    ,department: \"All Employees\"\r\n                    ,salaries: this.sum\r\n                    ,count: this.count\r\n                });\r\n"],[0,"    "]],"start1":1654,"start2":1654,"length1":235,"length2":8}]],"length":3292,"saved":false}
{"ts":1360356049856,"patch":[[{"diffs":[[0,"            "],[1,"//"],[0,"var salaryGr"]],"start1":2473,"start2":2473,"length1":24,"length2":26},{"diffs":[[0,"        "],[1,"//"],[0,"salaryGr"]],"start1":2601,"start2":2601,"length1":16,"length2":18},{"diffs":[[0,"            "],[1,"//"],[0,"row.find(\"td"]],"start1":2634,"start2":2634,"length1":24,"length2":26}]],"length":3298,"saved":false}
{"ts":1360356149591,"patch":[[{"diffs":[[0,"er, this);\r\n"],[1,"            util.loading(true);\r\n            this.collection.fetch({\r\n                success: function() { util.loading(false); }\r\n            })\r\n"],[0,"        }\r\n "]],"start1":2037,"start2":2037,"length1":24,"length2":172}]],"length":3446,"saved":false}
{"ts":1360356343274,"patch":[[{"diffs":[[0,"(false); }\r\n"],[1,"                ,error: function() {\r\n                    util.loading(false);\r\n                }\r\n                ,complete: function() {console.log(\"complete\")}\r\n"],[0,"            "]],"start1":2169,"start2":2169,"length1":24,"length2":188}]],"length":3610,"saved":false}
{"ts":1360356403139,"patch":[[{"diffs":[[0,"ch({"],[-1,"\r\n                success: function() { util.loading(false); }\r\n                ,error: function() {\r\n                    util.loading(false);\r\n                }"],[1," // TODO: Need error handler"],[0,"\r\n  "]],"start1":2113,"start2":2113,"length1":169,"length2":36},{"diffs":[[0,"() {"],[-1,"console.log(\"complete\")"],[1,"util.loading(false);"],[0,"}\r\n "]],"start1":2182,"start2":2182,"length1":31,"length2":28}]],"length":3474,"saved":false}
{"ts":1360356404608,"patch":[[{"diffs":[[0,"        "],[-1,","],[0,"complete"]],"start1":2155,"start2":2155,"length1":17,"length2":16}]],"length":3473,"saved":false}
{"ts":1360356413666,"patch":[[{"diffs":[[0,"      })"],[1,";"],[0,"\r\n      "]],"start1":2214,"start2":2214,"length1":16,"length2":17}]],"length":3474,"saved":false}
{"ts":1360360242168,"patch":[[{"diffs":[[0,"        "],[-1,"//"],[0,"var sala"]],"start1":2653,"start2":2653,"length1":18,"length2":16},{"diffs":[[0,"        "],[-1,"//"],[0,"salaryGr"]],"start1":2775,"start2":2775,"length1":18,"length2":16},{"diffs":[[0,"        "],[-1,"//"],[0,"row.find"]],"start1":2810,"start2":2810,"length1":18,"length2":16}]],"length":3468,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361394912488,"patch":[[{"diffs":[[-1,"var "],[1,"window.jQuery = window.jQuery || {};\r\nwindow._ = window._ || {};\r\nwindow.Backbone = window.Backbone || {};\r\nwindow."],[0,"Salaries"]],"start1":0,"start2":0,"length1":12,"length2":123},{"diffs":[[0,"aries = "],[1,"window."],[0,"Salaries"]],"start1":118,"start2":118,"length1":16,"length2":23},{"diffs":[[0,"ers: {}}"],[1,";"],[0,"\r\n"],[-1,"    ,"],[1,"window."],[0,"FusionTa"]],"start1":190,"start2":190,"length1":23,"length2":26},{"diffs":[[0,"Table = "],[1,"window."],[0,"FusionTa"]],"start1":214,"start2":214,"length1":16,"length2":23},{"diffs":[[0,"| {}"],[1,";"],[0,"\r\n"],[-1,"    ,util = "],[1,"window.util = window."],[0,"util"]],"start1":242,"start2":242,"length1":22,"length2":32},{"diffs":[[0,"unction("],[1,"window, $, _, Backbone, "],[0,"app, db,"]],"start1":285,"start2":285,"length1":16,"length2":40},{"diffs":[[0,"db, util"],[-1,", $, _"],[0,") {\r\n   "]],"start1":322,"start2":322,"length1":22,"length2":16},{"diffs":[[0,"   \r\n})("],[1,"window, window.jQuery, window._, window.Backbone, window."],[0,"Salaries"]],"start1":3576,"start2":3576,"length1":16,"length2":73},{"diffs":[[0,"laries, "],[1,"window."],[0,"FusionTa"]],"start1":3643,"start2":3643,"length1":16,"length2":23},{"diffs":[[0,"le, "],[-1,"util, jQuery, _"],[1,"window.util"],[0,");"]],"start1":3667,"start2":3667,"length1":21,"length2":17}]],"length":3684,"saved":false}
{"ts":1361394948117,"patch":[[{"diffs":[[0,"ject"],[-1,"[\""],[1,"."],[0,"count"],[-1,"\"]"],[0," || "]],"start1":1714,"start2":1714,"length1":17,"length2":14},{"diffs":[[0,"ject"],[-1,"[\""],[1,"."],[0,"salaries"],[-1,"\"]"],[0," || "]],"start1":1766,"start2":1766,"length1":20,"length2":17},{"diffs":[[0,"gleRow\")"],[1,";"],[0,"\r\n      "]],"start1":2000,"start2":2000,"length1":16,"length2":17}]],"length":3679,"saved":false}
{"ts":1361394956248,"patch":[[{"diffs":[[0,"t(row[i]"],[1,", 0"],[0,") : row["]],"start1":1526,"start2":1526,"length1":16,"length2":19}]],"length":3682,"saved":false}
